<!DOCTYPE html><html><head><link rel="icon" type="icon/png" href="test.png"><script>
var window = window;
var console = window.console;
var log = function (log) { window.console.log (log); };
var canvas = window.document.createElement ('canvas');
var context = canvas.getContext ('2d');
var game =
{
	canvas:
	{
		load: function ()
		{
			canvas.resize = function ()
			{
				this.height = game.window.height;
				this.width = game.window.width;
			};
		}
	},

	create:
	{
		sprite: function (sprite)
		{
			sprite.type = 'sprite';
			sprite.id = game.id++;

			sprite.image = sprite.image || new Image ();
			sprite.redraw = true;

			sprite.h = sprite.h || sprite.image.naturalHeight;
			sprite.w = sprite.w || sprite.image.naturalWidth;
			sprite.x = game.x (sprite);
			sprite.y = game.y (sprite);
			sprite.z = game.z (sprite);

			sprite.draw = function ()
			{
				game.draw.image ({ height: sprite.h, image: game.image.test, width: sprite.w, x: sprite.x, y: sprite.y });
			};

			game.scene[sprite.z].push (sprite);
		}
	},

	draw:
	{
		image: function (image)
		{
			console.time ('click');
			var h = image.height || this.naturalHeight;
			var i = image.image;
			var w = image.width || this.naturalWidth;
			var x = image.x * game.window.width || game.window.width * Math.random ();
			var	y = image.y * game.window.height || game.window.height * Math.random ();
			context.drawImage (i, x, y, w, h);;
			console.timeEnd ('click');
		},

		resize: false,

		scene: false,

		update: function ()
		{
			if (game.draw.scene)
			{
				for (var z = 0; z < Object.keys (game.scene).length; z++)
				{
					for (var id = game.scene[z].length; id-- ;)
					{
						if (game.draw.resize || game.scene[z][id].redraw)
						{
							context.clearRect (game.scene[z][id].x, game.scene[z][id].y, game.scene[z][id].width, game.scene[z][id].height);
							game.scene[z][id].redraw = false;
							game.scene[z][id].draw ();
						};
					};
				};
				game.draw.scene = false;
			};
		}
	},

	id: 0,

	image:
	{
		load: function ()
		{
			for (var id in game.image)
			{
				if (id != 'load')
				{
					var image = new Image ();
						image.src = game.image [id];
					game.image[id] = image;
				};
			};
		},
		test: 'test.png'
	},

	load: function ()
	{
		game.image.load ();
		game.canvas.load ();
		game.window.load ();
		game.timer.load ();
	},

	scene: { 0: [] },

	tick: 50,
	time: 0,
	timer:
	{
		clock: {},
		load: function ()
		{
			game.timer.clock = window.setInterval
			(
				function ()
				{
					game.update.tick ();
					game.time += game.tick;
				},
				game.tick
			);
		}
	},

	update:
	{
		click: function (event)
		{
			var tile = 10;
			game.create.sprite ({ height: tile, image: game.image.test, width: tile, x: event.clientX, y: event.clientY });
			game.draw.scene = true;
		},

		resize: function ()
		{
			window.resize ();
			canvas.resize ();
			game.draw.resize = true;
			game.draw.scene = true;
		},

		tick: function ()
		{
			game.draw.update ();
		}
	},

	window:
	{
		height: undefined,

		load: function ()
		{
			window.onclick = function (event)
			{
				game.update.click (event);
			};

			window.onload = function ()
			{
				game.update.resize ();
				this.document.body.appendChild (canvas);
			};

			window.onresize = function ()
			{
				game.update.resize ();
			};

			window.resize = function ()
			{
				game.window.height = this.innerHeight;
				game.window.width = this.innerWidth;
			};

			window.document.title = '0.' + JSON.stringify (game).length;
		},

		width: undefined
	},

	x: function (o)
	{
		var x = o.x || 0;
			x = (x > 1) ? x / game.window.width : x;
		o.redraw = true;
		return x;
	},

	y: function (o)
	{
		var y = o.y || 0;
			y = (y > 1) ? y / game.window.height : x;
		o.redraw = true;
		return y;
	},

	z: function (o)
	{
		var z = o.z || 0;
		if (z > Object.keys (game.scene).length)
		{
			game.scene[z].push ([]);
		};
		o.redraw = true;
		return z;
	}
};

game.load ();
</script><style>
	body { margin: 0; }
	canvas { position: absolute; }
</style></head></html>