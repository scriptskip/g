<!DOCTYPE html><html><head><link rel="icon" type="icon/png" href="test.png"><script>
var window = window;
var console = window.console;
var log = function (log) { window.console.log (log); };
var canvas = window.document.createElement ('canvas');
var context = canvas.getContext ('2d');
var game =
{
	canvas:
	{
		load: function ()
		{
			canvas.resize = function ()
			{
				this.height = game.window.height;
				this.width = game.window.width;
			};
		}
	},

	create:
	{
		sprite: function (sprite)
		{
			sprite.type = 'sprite';
			sprite.id = game.id++;

			sprite.image = sprite.image || new Image ();

			sprite.h = sprite.h || sprite.image.naturalHeight;
			sprite.w = sprite.w || sprite.image.naturalWidth;
			sprite.x = game.x (sprite.x);
			sprite.y = game.x (sprite.y);
			sprite.z = game.z (sprite.z);

			sprite.draw = function ()
			{
				game.draw.image ({ height: sprite.h, image: game.image.test, width: sprite.w, x: sprite.x, y: sprite.y });
			};

			game.scene[sprite.z].push (sprite);
		}
	},

	draw:
	{
		image: function (image)
		{
			console.time ('click');
			var h = image.height || this.naturalHeight;
			var i = image.image;
			var w = image.width || this.naturalWidth;
			var x, y;
			for (var n = 1000; n--;)
			{
				x = game.window.width * Math.random ();
				y = game.window.height * Math.random ();
				context.drawImage (i, x, y, w, h);
			};
			console.timeEnd ('click');
		},

		scene: false,

		update: function ()
		{
			if (game.draw.scene)
			{
				context.clearRect (0, 0, game.window.width, game.window.height);
				for (var z = 0; z < Object.keys (game.scene).length; z++)
				{
					for (var id = game.scene[z].length; id-- ;)
					{
						game.scene[z][id].draw ();
					};
				};
				game.draw.scene = false;
			};
		}
	},

	id: 0,

	image:
	{
		load: function ()
		{
			for (var id in game.image)
			{
				if (id != 'load')
				{
					var image = new Image ();
						image.src = game.image [id];
					game.image[id] = image;
				};
			};
		},
		test: 'test.png'
	},

	load: function ()
	{
		game.image.load ();
		game.canvas.load ();
		game.window.load ();
		game.timer.load ();
	},

	resize: function ()
	{
		window.resize ();
		canvas.resize ();
	},

	scene: { 0: [] },

	tick: 50,
	time: 0,
	timer:
	{
		clock: {},
		load: function ()
		{
			game.timer.clock = window.setInterval
			(
				function ()
				{
					game.update.tick ();
					game.time += game.tick;
				},
				game.tick
			);
		}
	},

	update:
	{
		click: function (event)
		{
			var tile = 10;
			game.create.sprite ({ height: tile, image: game.image.test, width: tile, x: 0.5, y: 0.5 });
			game.draw.scene = true;
		},

		tick: function ()
		{
			game.draw.update ();
		}
	},

	window:
	{
		height: undefined,

		load: function ()
		{
			window.onclick = function (event)
			{
				game.update.click (event);
			};

			window.onload = function ()
			{
				game.resize ();
				this.document.body.appendChild (canvas);
			};

			window.onresize = function ()
			{
				game.resize ();
			};

			window.resize = function ()
			{
				game.window.height = this.innerHeight;
				game.window.width = this.innerWidth;
			};

			window.document.title = '0.' + JSON.stringify (game).length;
		},

		width: undefined
	},

	x: function (x) { x = x || 0; x = (x > 1) ? x / game.window.width : x; return x; },
	y: function (y) { y = y || 0; y = (y > 1) ? y / game.window.height : x; return y; },
	z: function (z) { z = z || 0; if (z > Object.keys (game.scene).length) { game.scene[z].push ([]); }; return z; }
};

game.load ();
</script><style>
	body { margin: 0; }
	canvas { position: absolute; }
</style></head></html>